<?php
/**
 * Template part for displaying phone number with messenger links
 * 
 * @package mib
 */

$args = wp_parse_args( $args, array(
    'phone'         => '',
    'class'         => 'phone-link',
    'telegram'      => '',
    'viber'         => '',
    'wrapper_class' => 'contacts-block',
    'show_icons'    => true
) );

$phone = !empty($args['phone']) ? $args['phone'] : get_theme_mod('phone');
$telegram = !empty($args['telegram']) ? $args['telegram'] : get_theme_mod('telegram');
$viber = !empty($args['viber']) ? $args['viber'] : get_theme_mod('viber');
$has_wrapper = !empty($args['wrapper_class']);

if (!empty($phone) || !empty($telegram) || !empty($viber)) {

    if ( $has_wrapper ) {
        echo '<div class="' . esc_attr($args['wrapper_class']) . '">';
    }
    
    if (!empty($phone)) {
        $clean_phone = preg_replace('/\D/', '', $phone);
        
        $formatted_phone = esc_html($phone);
        $formatted_phone = preg_replace('/\(/', '<span>(', $formatted_phone, 1);
        $formatted_phone = preg_replace('/\)/', ')</span>', $formatted_phone, 1);
        
        ?>
        <a href="tel:<?php echo $clean_phone; ?>" class="<?php echo esc_attr($args['class']); ?>"><?php echo $formatted_phone; ?></a>
        <?php
    }
    
    if (!empty($viber)) {
        $clean_viber = preg_replace('/\D/', '', $viber);
        $viber_url = esc_url('viber://chat?number=' . $clean_viber);
        ?>
        <?php if ($args['show_icons']) : ?>
            <a href="<?php echo $viber_url; ?>" class="messenger-link viber-link" target="_blank">
                <svg width="13" height="15" viewBox="0 0 13 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.86802 0.75203C7.77057 0.283177 5.59548 0.283177 3.49802 0.75203L3.27202 0.80203C2.68187 0.933585 2.13982 1.22635 1.7062 1.64772C1.27258 2.0691 0.96442 2.60256 0.816024 3.1887C0.285284 5.28383 0.285284 7.47823 0.816024 9.57336C0.95756 10.1324 1.24454 10.6439 1.64781 11.0561C2.05107 11.4683 2.55625 11.7663 3.11202 11.92L3.42202 13.7707C3.43192 13.8295 3.45739 13.8845 3.49578 13.9301C3.53417 13.9757 3.58408 14.0101 3.64031 14.0299C3.69654 14.0496 3.75703 14.0539 3.81549 14.0423C3.87395 14.0308 3.92823 14.0037 3.97269 13.964L5.79336 12.3354C7.16008 12.4179 8.53161 12.3086 9.86802 12.0107L10.0947 11.9607C10.6848 11.8291 11.2269 11.5364 11.6605 11.115C12.0941 10.6936 12.4023 10.1602 12.5507 9.57403C13.0814 7.4789 13.0814 5.2845 12.5507 3.18936C12.4022 2.60314 12.094 2.06962 11.6602 1.64824C11.2265 1.22686 10.6843 0.934142 10.094 0.802697L9.86802 0.75203ZM4.06069 3.1347C3.93679 3.11655 3.81041 3.1415 3.70269 3.20536H3.69336C3.44336 3.35203 3.21802 3.5367 3.02602 3.75403C2.86602 3.9387 2.77936 4.12536 2.75669 4.30536C2.74336 4.41203 2.75269 4.52003 2.78402 4.62203L2.79602 4.6287C2.97602 5.15736 3.21069 5.66603 3.49736 6.1447C3.86715 6.81692 4.32201 7.4387 4.85069 7.9947L4.86669 8.01736L4.89202 8.03603L4.90736 8.05403L4.92602 8.07003C5.48401 8.60025 6.10725 9.05726 6.78069 9.43003C7.55069 9.84936 8.01802 10.0474 8.29869 10.13V10.134C8.38069 10.1594 8.45536 10.1707 8.53069 10.1707C8.76984 10.1535 8.99624 10.0563 9.17336 9.8947C9.39002 9.7027 9.57336 9.4767 9.71602 9.22536V9.2207C9.85002 8.96736 9.80469 8.7287 9.61136 8.5667C9.22334 8.22698 8.80339 7.92558 8.35736 7.6667C8.05869 7.5047 7.75536 7.6027 7.63269 7.7667L7.37069 8.09736C7.23602 8.26136 6.99202 8.2387 6.99202 8.2387L6.98536 8.2427C5.16469 7.77803 4.67869 5.9347 4.67869 5.9347C4.67869 5.9347 4.65602 5.68403 4.82469 5.55603L5.15269 5.29203C5.31002 5.16403 5.41936 4.86136 5.25069 4.5627C4.99241 4.11698 4.69168 3.69725 4.35269 3.30936C4.27854 3.21828 4.17469 3.15621 4.05936 3.13403M7.13669 2.33336C7.04829 2.33336 6.9635 2.36848 6.90099 2.43099C6.83848 2.49351 6.80336 2.57829 6.80336 2.6667C6.80336 2.7551 6.83848 2.83989 6.90099 2.9024C6.9635 2.96491 7.04829 3.00003 7.13669 3.00003C7.98002 3.00003 8.68002 3.27536 9.23402 3.80336C9.51869 4.09203 9.74069 4.43403 9.88602 4.8087C10.032 5.18403 10.0987 5.5847 10.0814 5.98603C10.0795 6.0298 10.0863 6.07351 10.1014 6.11466C10.1164 6.1558 10.1394 6.19358 10.1691 6.22583C10.229 6.29097 10.3123 6.32965 10.4007 6.33336C10.4891 6.33708 10.5754 6.30552 10.6405 6.24563C10.7056 6.18575 10.7443 6.10244 10.748 6.01403C10.7679 5.5204 10.686 5.02796 10.5074 4.56736C10.3279 4.10442 10.0546 3.6836 9.70469 3.33136L9.69802 3.3247C9.01069 2.66803 8.14069 2.33336 7.13669 2.33336ZM7.11402 3.42936C7.02562 3.42936 6.94083 3.46448 6.87832 3.52699C6.81581 3.58951 6.78069 3.67429 6.78069 3.7627C6.78069 3.8511 6.81581 3.93589 6.87832 3.9984C6.94083 4.06091 7.02562 4.09603 7.11402 4.09603H7.12536C7.73336 4.13936 8.17602 4.34203 8.48602 4.6747C8.80402 5.01736 8.96869 5.44336 8.95602 5.97003C8.95399 6.05844 8.98716 6.14403 9.04823 6.20798C9.10931 6.27193 9.19329 6.309 9.28169 6.31103C9.3701 6.31306 9.45569 6.27989 9.51964 6.21882C9.58359 6.15775 9.62066 6.07377 9.62269 5.98536C9.63869 5.29403 9.41602 4.69736 8.97469 4.22136V4.22003C8.52336 3.73603 7.90402 3.48003 7.15869 3.43003L7.14736 3.4287L7.11402 3.42936ZM7.10136 4.54603C7.05675 4.54209 7.0118 4.54719 6.96921 4.56101C6.92661 4.57482 6.88723 4.59708 6.85343 4.62646C6.81962 4.65583 6.79208 4.69171 6.77245 4.73196C6.75283 4.77221 6.74151 4.81601 6.73918 4.86073C6.73685 4.90545 6.74355 4.95018 6.75889 4.99226C6.77423 5.03433 6.79789 5.07288 6.82846 5.10561C6.85903 5.13833 6.89588 5.16457 6.93681 5.18274C6.97774 5.20091 7.02191 5.21064 7.06669 5.21136C7.34536 5.22603 7.52336 5.31003 7.63536 5.4227C7.74802 5.53603 7.83202 5.71803 7.84736 6.0027C7.84819 6.04743 7.85802 6.09154 7.87626 6.13239C7.8945 6.17324 7.92078 6.21001 7.95352 6.24049C7.98627 6.27097 8.02482 6.29455 8.06688 6.30982C8.10893 6.32509 8.15363 6.33174 8.19831 6.32936C8.24299 6.32699 8.28673 6.31565 8.32693 6.29601C8.36713 6.27637 8.40297 6.24885 8.43231 6.21507C8.46164 6.18129 8.48388 6.14195 8.49769 6.09939C8.5115 6.05683 8.5166 6.01193 8.51269 5.96736C8.49136 5.56736 8.36602 5.21403 8.10936 4.95403C7.85136 4.69403 7.50002 4.56736 7.10136 4.54603Z" fill="currentColor"/>
                </svg>
            </a>
        <?php endif; ?>
        <?php
    }
    
    if (!empty($telegram)) {
        $telegram_url = esc_url('https://t.me/' . str_replace('@', '', $telegram));
        ?>
        <?php if ($args['show_icons']) : ?>
            <a href="<?php echo $telegram_url; ?>" class="messenger-link telegram-link" target="_blank">
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.75065 0.333496C3.07065 0.333496 0.0839844 3.32016 0.0839844 7.00016C0.0839844 10.6802 3.07065 13.6668 6.75065 13.6668C10.4307 13.6668 13.4173 10.6802 13.4173 7.00016C13.4173 3.32016 10.4307 0.333496 6.75065 0.333496ZM9.84398 4.86683C9.74398 5.92016 9.31065 8.48016 9.09065 9.66016C8.99732 10.1602 8.81065 10.3268 8.63732 10.3468C8.25065 10.3802 7.95732 10.0935 7.58398 9.84683C6.99732 9.46016 6.66398 9.22016 6.09732 8.84683C5.43732 8.4135 5.86398 8.1735 6.24398 7.78683C6.34398 7.68683 8.05065 6.1335 8.08398 5.9935C8.08861 5.97229 8.088 5.95028 8.08219 5.92937C8.07638 5.90845 8.06555 5.88927 8.05065 5.8735C8.01065 5.84016 7.95732 5.8535 7.91065 5.86016C7.85065 5.8735 6.91732 6.4935 5.09732 7.72016C4.83065 7.90016 4.59065 7.9935 4.37732 7.98683C4.13732 7.98016 3.68398 7.8535 3.34398 7.74016C2.92398 7.60683 2.59732 7.5335 2.62398 7.30016C2.63732 7.18016 2.80398 7.06016 3.11732 6.9335C5.06398 6.08683 6.35732 5.52683 7.00398 5.26016C8.85732 4.48683 9.23732 4.3535 9.49065 4.3535C9.54399 4.3535 9.67065 4.36683 9.75065 4.4335C9.81732 4.48683 9.83732 4.56016 9.84398 4.6135C9.83732 4.6535 9.85065 4.7735 9.84398 4.86683Z" fill="currentColor"/>
                </svg>
            </a>
        <?php endif; ?>
        <?php
    }
    
    if ( $has_wrapper ) {
        echo '</div>';
    }
}
?>